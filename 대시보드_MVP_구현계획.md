## 서울교통공사 지하철 혼잡도 CSV 대시보드 (MVP) 구현계획

### 1) 목표(최소 스펙)
- **핵심 목표**: “어느 역/시간대/방향이 가장 혼잡한가?”를 빠르게 찾는다.
- **대상 사용자(가정)**: 분석/운영/기획(내부 사용) 또는 일반 사용자.
- **핵심 사용 시나리오**
  - 특정 **호선**에서 피크 혼잡 **Top 역**을 찾는다.
  - 특정 **역**의 시간대별 혼잡 패턴을 확인한다.
  - **운행구분(상/하행 등)**에 따라 차이를 비교한다.

### 2) 데이터 개요(파일 기준)
- 입력 파일: `서울교통공사_지하철혼잡도정보_20250930.csv`
- 구조: `운영기관, 호선, 역번호, 역명, 운행구분 + (5:30 ~ 00:30, 30분 간격 시간 컬럼)`
- 주의: 현재 미리보기에서 **한글 인코딩이 깨져 보일 수 있음** → 로딩 시 인코딩 확정 필요.

### 3) MVP 화면 구성
#### 3.1 사이드바 필터(최소)
- **호선(필수)**
- **역(선택)**: 전체/특정역
- **운행구분(선택)**: 전체/상행/하행(또는 내선/외선 등 실제 값)
- **시간대 범위(선택)**: 예) 05:30~00:30 슬라이더(범위)

#### 3.2 메인 탭
- **탭 1: 역 상세**
  - 시간대별 혼잡도 **라인차트**
  - KPI: **피크 혼잡도(최대값)**, **피크 시간**
- **탭 2: 랭킹**
  - 선택 조건(호선/시간범위/운행구분)에서 **Top N 역 테이블**
  - 기본 랭킹 기준: **피크(max) 혼잡도**

### 4) 지표/집계 정의(최소)
- **피크 혼잡도(peak)**: 선택된 시간 범위 내 혼잡도 값의 `max`
- **피크 시간(peak_time)**: `max`가 발생한 시간 컬럼
- **평균 혼잡도(avg)**(옵션): 선택 범위 내 `mean`
- **결측/0 처리(초기 가정)**: MVP에서는 일단 숫자값 그대로 사용(0 포함). 추후 Phase 0에서 정책 확정.

---

## 5) Phase 단위 구현 계획

### Phase 0 — 데이터/정의 확정 (반나절~1일)
- **인코딩 확정**: CSV 로딩 시 `cp949/euc-kr/utf-8-sig` 등 확인 후 고정
- **컬럼 정규화**
  - 시간 컬럼을 `HH:MM` 형태로 표준화(예: `5시30분 → 05:30`)
  - 숫자 컬럼 공백/문자 제거 후 float 변환
- **값 의미 확인**
  - 혼잡도 수치의 단위/범위(%, 지수 등)
  - 운행구분 값(상행/하행/내선/외선 등) 정의
- **예외 규칙 결정**: 0.0/공백/이상치 처리 기준

### Phase 1 — MVP 구현 (1~2일)
- **데이터 로더/전처리**
  - wide(시간컬럼 여러 개) → long 형태로 변환
    - 키: (호선, 역번호, 역명, 운행구분)
    - 값: (시간, 혼잡도)
  - Streamlit 캐싱 적용(`st.cache_data`)로 재로딩 최소화
- **UI 구현**
  - 사이드바 필터 4종
  - 탭1(역 상세): 라인차트 + 피크 KPI
  - 탭2(랭킹): Top N 테이블(정렬/포맷 포함)
- **기본 품질**
  - 필터 결과가 비는 경우 안내 메시지
  - Top N 기본값(예: 20), 정렬/숫자 포맷

### Phase 2 — 분석력 강화 (1~2일)
- **히트맵(선택)**: (역 × 시간) 혼잡도 히트맵
- **비교 기능**: 역 2~3개 멀티 선택 라인차트 비교
- **다운로드**: 필터 적용 결과 CSV 다운로드

### Phase 3 — 운영/배포/정리 (0.5~1일)
- **코드 구조화**: `data.py`(로딩/전처리), `charts.py`(차트), `app.py`(UI) 분리
- **재현 가능한 실행**: `requirements.txt` 고정, 실행 명령 정리
- **배포 옵션 정리**: Streamlit Community Cloud / 사내 서버 / Docker 중 택1

---

## 6) MVP 완료 기준(Definition of Done)
- 호선/역/운행구분/시간범위 필터로 화면이 정상 동작
- 역 상세에서 시간대별 라인차트와 피크 KPI가 표시
- 랭킹 탭에서 Top N 역이 조건에 맞게 정렬되어 표시
- CSV 인코딩 문제 없이 한글 컬럼/값이 정상 표기

## 7) 다음 결정사항(1~2개만 먼저)
- 랭킹 기준을 **피크(max)**로 고정할지, 출근/퇴근 **구간 평균** 옵션을 바로 넣을지
- 0.0 값을 **실제 0**으로 볼지, **결측**으로 볼지
